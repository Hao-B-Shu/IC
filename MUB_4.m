n=4;
E=eye(n);
M0=eye(n);

M1=zeros(n);
M1(:,1)=E(:,1)+E(:,2)+E(:,3)+E(:,4);
M1(:,2)=E(:,1)+E(:,2)-E(:,3)-E(:,4);
M1(:,3)=E(:,1)-E(:,2)-E(:,3)+E(:,4);
M1(:,4)=E(:,1)-E(:,2)+E(:,3)-E(:,4);

M2=zeros(n);
M2(:,1)=E(:,1)-E(:,2)-i*E(:,3)-i*E(:,4);
M2(:,2)=E(:,1)-E(:,2)+i*E(:,3)+i*E(:,4);
M2(:,3)=E(:,1)+E(:,2)+i*E(:,3)-i*E(:,4);
M2(:,4)=E(:,1)+E(:,2)-i*E(:,3)+i*E(:,4);

M3=zeros(n);
M3(:,1)=E(:,1)-i*E(:,2)-i*E(:,3)-E(:,4);
M3(:,2)=E(:,1)-i*E(:,2)+i*E(:,3)+E(:,4);
M3(:,3)=E(:,1)+i*E(:,2)+i*E(:,3)-E(:,4);
M3(:,4)=E(:,1)+i*E(:,2)-i*E(:,3)+E(:,4);

M4=zeros(n);
M4(:,1)=E(:,1)-i*E(:,2)-E(:,3)-i*E(:,4);
M4(:,2)=E(:,1)-i*E(:,2)+E(:,3)+i*E(:,4);
M4(:,3)=E(:,1)+i*E(:,2)-E(:,3)+i*E(:,4);
M4(:,4)=E(:,1)+i*E(:,2)+E(:,3)-i*E(:,4);

M=cell(1,n+1);
M{1,1}=M0;
M{1,2}=M1;
M{1,3}=M2;
M{1,4}=M3;
M{1,5}=M4;

Q=cell(1,n+1);
for l=1:n+1
    for k=1:n
        Q{1,l}(:,k)=reshape(M{1,l}(:,k)*M{1,l}(:,k)'/(norm(M{1,l}(:,k))^2)-(1/n)*E,n*n,1);
    end
    Q{1,l}=orth(Q{1,l});
end

H=[];
for l=1:n+1
    H=[H,Q{1,l}];
end
[QH,RH]=qr(H);
H=[H,QH(:,n^2)];

d=abs(det(H))
